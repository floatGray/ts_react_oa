import{a as i,E as c,j as t}from"./render-d5b6b10e.js";import{_ as z}from"./lodash-6097c51b.js";import{b as L,u as l,j as f,t as y,o as k,d as D,C as O,v as W,m as B}from"./index-c4545837.js";import{S as v}from"./index-5981696e.js";import{I as N}from"./index-d6a4ba23.js";import{B as d}from"./button-419145c3.js";import{D as P,T as G}from"./Table-58a956de.js";import{R as K}from"./index-31c898e5.js";import{C as q}from"./index-e9e7f485.js";import{R as F,S as H}from"./row-d1ac2986.js";import"./useFlexGapSupport-a785865b.js";import"./index-6b4c7132.js";import"./dropdown-721cfb76.js";import"./Dropdown-2c6b0279.js";import"./index-d48a2202.js";import"./colors-1216520c.js";const b={"check-title":"_check-title_15n9h_1","check-table":"_check-table_15n9h_5"},_=[{label:"全部",value:"全部"},{label:"待审批",value:"待审批"},{label:"已通过",value:"已通过"},{label:"未通过",value:"未通过"}],C=_[0].value;function ne(){const[n,g]=i.useState(C),[u,x]=i.useState(""),a=L(),r=l(e=>e.users.infos),h=l(e=>e.news.info),p=l(e=>e.checks.checkList).filter(e=>(e.state===n||C===n)&&e.note.includes(u));i.useEffect(()=>{z.isEmpty(p)&&a(f({approverid:r._id})).then(e=>{const{errcode:o,rets:s}=e.payload.data;o===0&&a(y(s))})},[p,r,a]),i.useEffect(()=>{h.approver&&a(k({userid:r._id,approver:!1})).then(e=>{const{errcode:o,info:s}=e.payload.data;o===0&&a(D(s))})},[a,r,h]);const m=(e,o,s)=>()=>{a(W({_id:e,state:o})).then(w=>{const{errcode:T}=w.payload.data;T===0&&(B.success("审批成功"),a(f({approverid:r._id})).then(j=>{const{errcode:E,rets:R}=j.payload.data;E===0&&a(y(R))}),a(k({userid:s,applicant:!0})))})},I=[{title:"申请人",dataIndex:"applicantname",key:"applicantname",width:180},{title:"审批事由",dataIndex:"reason",key:"reason",width:180},{title:"时间",dataIndex:"time",key:"time",render(e){return e.join("-")}},{title:"备注",dataIndex:"note",key:"note"},{title:"操作",dataIndex:"handle",key:"handle",width:180,render(e,o){return c(v,{children:[t(d,{type:"primary",shape:"circle",size:"small",icon:t(q,{}),style:{backgroundColor:"#67c23a",border:"1px #67c23a solid"},onClick:m(o._id,"已通过",o.applicantid)}),t(d,{type:"primary",danger:!0,shape:"circle",size:"small",icon:t(O,{}),onClick:m(o._id,"未通过",o.applicantid)})]})}},{title:"状态",dataIndex:"state",key:"state",width:180}],S=e=>{g(e.target.value)},A=e=>{x(e.target.value)};return c("div",{children:[t(F,{className:b["check-title"],justify:"end",children:c(v,{children:[t(N,{placeholder:"请输入关键词",value:u,onChange:A}),t(d,{type:"primary",icon:t(H,{}),children:"搜索"}),t(P,{type:"vertical",style:{borderLeftColor:"#dcdfe6"}}),t(K.Group,{options:_,optionType:"button",buttonStyle:"solid",value:n,onChange:S})]})}),t(G,{rowKey:"_id",className:b["check-table"],dataSource:p,columns:I,size:"small",pagination:{defaultPageSize:5}})]})}export{ne as default};
